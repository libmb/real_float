#!/bin/sh

set -e

cd "$(dirname "$0")/../.."

echo "################################################################################"
echo "# [WARNING] This file is auto-generated by script.  Do not modify it manually. #"
echo "################################################################################"
printf "
include ../../build/include/name.mk

all: \$(NAME)
	cp \$^ ../..
.PHONY: all

\$(NAME): %s
	rm -f \$@ \$@.tmp
	\$(AR) -c -r -s \$@.tmp \$^
	mv \$@.tmp \$@

CPPFLAGS = -I ../../include -I ../../external_include -D NDEBUG

" "$(sh build/script/get-source.sh | sed s/\\.c/.o/ | xargs)"

sh build/script/get-source.sh | while IFS= read -r SRC; do
  printf "%s: %s\n\tmkdir -p %s\n\t\$(CC) \$(CFLAGS) \$(CPPFLAGS) -c -o \$@ \$^\n" "${SRC%.c}.o" "../../src/$SRC" "$(dirname "$SRC")"
done
